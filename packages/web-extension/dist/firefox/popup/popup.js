import{c as F,f as v,u as U,o as j,R as g,a as w,j as n,B as z,r as h,b as m,d as f,F as C,T as b,S as A,e as q,I as _,g as H,h as W,i as O,k as Z,l as K,L as V,m as J,C as Q}from"../browser-polyfill.js";import{L as u,S as y,R as i,C as X,s as Y,E as tt}from"../storage.js";var N=(...t)=>t.filter(Boolean).join(" "),[et,D]=F({name:"StatStylesContext",errorMessage:`useStatStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Stat />" `}),P=v(function(e,a){const s=U("Stat",e),l={position:"relative",flex:"1 1 0%",...s.container},{className:c,children:d,...T}=j(e);return g.createElement(et,{value:s},g.createElement(w.div,{ref:a,...T,className:N("chakra-stat",c),__css:l},n("dl",{children:d})))});P.displayName="Stat";var at=v(function(e,a){return g.createElement(w.div,{...e,ref:a,role:"group",className:N("chakra-stat__group",e.className),__css:{display:"flex",flexWrap:"wrap",justifyContent:"space-around",alignItems:"flex-start"}})});at.displayName="StatGroup";var st=v(function(e,a){const s=D();return g.createElement(w.dd,{ref:a,...e,className:N("chakra-stat__help-text",e.className),__css:s.helpText})});st.displayName="StatHelpText";var rt=v(function(e,a){const s=D();return g.createElement(w.dt,{ref:a,...e,className:N("chakra-stat__label",e.className),__css:s.label})});rt.displayName="StatLabel";var M=v(function(e,a){const s=D();return g.createElement(w.dd,{ref:a,...e,className:N("chakra-stat__number",e.className),__css:{...s.number,fontFeatureSettings:"pnum",fontVariantNumeric:"proportional-nums"}})});M.displayName="StatNumber";function k({diameter:t,onClick:e,children:a,title:s,...l}){return n(z,{w:`${t}rem`,h:`${t}rem`,padding:`${t/2}rem`,borderRadius:9999,textAlign:"center",bgColor:"gray.100",boxSizing:"content-box",onClick:e,title:s,...l,children:a})}function nt(){return window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}const B=1e3,I=60*B,$=60*I;function ot(t){if(t<=0)return"00:00";const e=Math.floor(t/$);t=t%$;const a=Math.floor(t/I);t=t%I;const s=Math.floor(t/B);return e?`${E(e)}:${E(a)}:${E(s)}`:`${E(a)}:${E(s)}`}function E(t,e=2){let a=String(t);const s=Math.pow(10,e-1);if(t<s)for(;String(s).length>a.length;)a=`0${t}`;return a}function it({startTime:t,ticking:e}){const[a,s]=h.exports.useState(Date.now()-t);return h.exports.useEffect(()=>{if(!e)return;const l=setInterval(()=>{s(Date.now()-t)},100);return()=>clearInterval(l)},[t,e]),n(P,{textAlign:"center",mt:4,children:n(M,{fontSize:"3xl",children:ot(a)})})}async function ct(t,e,a){a||(a=(await m.storage.local.get(u.recorderStatus))[u.recorderStatus]);const{startTimestamp:s,activeTabId:l}=a,c=await t.requestToTab(l,y.PauseRecord,{});if(!c)return;const d={status:e,activeTabId:l,startTimestamp:s,pausedTimestamp:c.endTimestamp};return await m.storage.local.set({[u.recorderStatus]:d}),{status:d,bufferedEvents:c.events}}async function lt(t,e,a,s){a||(a=(await m.storage.local.get(u.recorderStatus))[u.recorderStatus]),s||(s=(await m.storage.local.get(u.bufferedEvents))[u.bufferedEvents]);const{startTimestamp:l,pausedTimestamp:c}=a;nt()&&await new Promise(r=>setTimeout(r,50));const d=await t.requestToTab(e,y.ResumeRecord,{events:s,pausedTimestamp:c});if(!d)return;const T=c?d.startTimestamp-c:0,o={status:i.RECORDING,activeTabId:e,startTimestamp:(l||s[0].timestamp)+T};return await m.storage.local.set({[u.recorderStatus]:o}),o}const R=3,S=new X;function ut(){const[t,e]=h.exports.useState(i.IDLE),[a,s]=h.exports.useState(""),[l,c]=h.exports.useState(0),[d,T]=h.exports.useState(null);return h.exports.useEffect(()=>{m.storage.local.get(u.recorderStatus).then(o=>{const r=o;if(!r||!r[u.recorderStatus])return;const{status:x,startTimestamp:p,pausedTimestamp:L}=r[u.recorderStatus];e(x),p&&L?c(Date.now()-L+p||0):p&&c(p)})},[]),f(C,{direction:"column",w:300,padding:"5%",children:[f(C,{children:[n(b,{fontSize:"md",fontWeight:"bold",children:"RRWeb Recorder"}),n(A,{}),f(q,{direction:"row",children:[n(_,{onClick:()=>{m.tabs.create({url:"/pages/index.html#/"})},size:"xs",icon:n(H,{}),"aria-label":"Session List",title:"Session List"}),n(_,{onClick:()=>{m.runtime.openOptionsPage()},size:"xs",icon:n(W,{}),"aria-label":"Settings button",title:"Settings"})]})]}),t!==i.IDLE&&l&&n(it,{startTime:l,ticking:t===i.RECORDING}),f(C,{justify:"center",gap:"10",mt:"5",mb:"5",children:[[i.IDLE,i.RECORDING].includes(t)&&n(k,{diameter:R,title:t===i.IDLE?"Start Recording":"Stop Recording",onClick:()=>{t===i.RECORDING?(s(""),S.getCurrentTabId().then(o=>{o!==-1&&S.requestToTab(o,y.StopRecord,{}).then(async r=>{if(!r)return;e(i.IDLE);const x={status:i.IDLE,activeTabId:o};await m.storage.local.set({[u.recorderStatus]:x}),r.session&&(T(r.session),await Y(r.session,r.events).catch(p=>{s(p.message)}),S.emit(tt.SessionUpdated,{}))}).catch(r=>{s(r.message)})})):S.getCurrentTabId().then(o=>{o!==-1&&S.requestToTab(o,y.StartRecord,{}).then(async r=>{if(r){e(i.RECORDING),c(r.startTimestamp);const x={status:i.RECORDING,activeTabId:o,startTimestamp:r.startTimestamp};await m.storage.local.set({[u.recorderStatus]:x})}}).catch(r=>{s(r.message)})})},children:n(O,{w:`${R}rem`,h:`${R}rem`,borderRadius:t===i.IDLE?9999:6,margin:"0",bgColor:"red.500"})}),t!==i.IDLE&&n(k,{diameter:R,title:t===i.RECORDING?"Pause Recording":"Resume Recording",onClick:()=>{t===i.RECORDING?ct(S,i.PAUSED).then(o=>{!o||e(o==null?void 0:o.status.status)}):S.getCurrentTabId().then(o=>{o!==-1&&lt(S,o).then(r=>{!r||(e(r.status),r.startTimestamp&&c(r.startTimestamp))}).catch(r=>{s(r.message)})})},children:f(O,{w:`${R}rem`,h:`${R}rem`,borderRadius:9999,margin:"0",color:"gray.600",children:[[i.PAUSED,i.PausedSwitch].includes(t)&&n(Z,{style:{paddingLeft:"0.5rem",width:"100%",height:"100%"}}),t===i.RECORDING&&n(K,{style:{width:"100%",height:"100%"}})]})})]}),d&&f(b,{children:[n(b,{as:"b",children:"New Session: "}),n(V,{href:m.runtime.getURL(`pages/index.html#/session/${d.id}`),isExternal:!0,children:d.name})]}),a!==""&&f(b,{color:"red.500",fontSize:"md",children:[a,n("br",{}),"Maybe refresh your current tab."]})]})}const G=document.getElementById("root");G&&J(G).render(n(g.StrictMode,{children:n(Q,{children:n(ut,{})})}));
